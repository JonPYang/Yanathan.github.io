<!DOCTYPE html>

<html>
<script>

var drawCount = 5, buyCount = 1, actionCount = 1, moneyCount = 0;
var copper = {name:'copper', cardType:'money', money:1, cost:0, remainingCards:30}, silver = {name:'silver', cardType:'money', money:2, cost:3, remainingCards:12}, gold = {name:'gold', cardType:'money', money:3, cost:6, remainingCards:12};
var estate = {name:'estate', cardType:'victoryCard', money:0, cost:2, remainingCards: 8}
var chapel = {cardType:'action', cost:2};
var moat = {cardType:'actionReaction', card:2, cost:2};
var bureaucrat = {cardType:'actionAttack', cost:4};
var village = {cardType:'action', cost:3, card:1, actions:2};
var buyableCards = [copper, silver, gold]
var playerDeck = [copper,copper,copper,copper,copper,copper,copper,estate,estate,estate], hand = [], discardPile = [];


/* TODO: 
Enable cards keeping track of player values (draw/buy/action/money/victory points)

Create limit for buyable cards
Work in actionable cards
Create end game conditions

Work in multiple players
Work in online functionality*/

/*additional TODO:
Fix first turn to start as a first turn
Clean up GUI to show buyable cards on the side with cost and money remaining
Show cards on mouseover
Create log box for each action that occurs

Change deck and discard pile to only show numbers of cards remaining instead of card values themselves

*/
function newTurn() {
    while(hand.length > 0) {
        discardFromHand(hand[0]);
    }
    if (playerDeck.length >= drawCount) {
        add(playerDeck);
    } 
    else {
        reDeck(discardPile);
        add(playerDeck);
    }
    removeBuyableCards();
    buyCount = 1;
    moneyCount = 0;
    updateAll();
}

function updateAll(){
    document.getElementById("displayMoney").innerHTML=moneyCount;
    document.getElementById("displayActions").innerHTML=actionCount;
    document.getElementById("displayBuys").innerHTML=buyCount;
    deckReader();
    discardReader();
}

function add(cards){
    if(cards instanceof Array){
      for(var i = 0; i < drawCount && cards.length !== 0; i++) {
            hand.unshift(cards.shift()); 
            var deckCard = document.createElement("input");
            var currentCard = hand[0];
            deckCard.card = currentCard
            deckCard.setAttribute("type", "button");
            deckCard.setAttribute("Id", currentCard.name);
            deckCard.setAttribute("value", currentCard.name);
            deckCard.setAttribute("onclick", "onCardPress(this.card)");
            document.getElementById("playableHand").appendChild(deckCard);
        }
    }
    else if(cards){
        hand.unshift(cards);
        var deckCard = document.createElement("input");
        deckCard.setAttribute("type", "button");
        deckCard.setAttribute("Id", cards.name);
        deckCard.setAttribute("value", cards.name);
        document.getElementById(cards.name).onClick(cards);
        document.getElementById("playableHand").appendChild(deckCard);
    }
    
    else 
        document.getElementById("errorCatch").innerHTML="ERROR: FAILURE TO ADD CARD";
    
    return hand;
}

function onCardPress(card){
    document.getElementById("1").innerHTML="Card = " + card.name
    document.getElementById("2").innerHTML="Card.cardType = " + card.cardType
    if(card.cardType === 'money') {
        moneyCount += card.money;
    }
    else if(card.cardType === 'actionReaction') {
        
    }
    else if(card.cardType === 'actionAttack') {
        
    }
    else if(card.cardType === 'action') {
        
    }
    else if(card.cardType === 'victoryCard') {
        
    }
    else {
        document.getElementById("errorCatch").innerHTML="ERROR, CARD TYPE NOT FOUND";         
    }
    updateAll();
    discardFromHand(card);
}


function buyList(){
    //var buyableCardArray = listOfBuyableCards()
    if(buyCount >= 1){
        for (var i in buyableCards) {
            var currentCard = buyableCards[i];
            var buyable = document.createElement("input");
            buyable.card = currentCard;
            buyable.setAttribute("type", "button");
            buyable.setAttribute("name", "PurchasableCards");
            buyable.value = currentCard.name + " " + currentCard.remainingCards;
            buyable.Id = currentCard.name;
            buyable.setAttribute("onclick", "buy(this.card)");
            document.getElementById("buyableCards").appendChild(buyable);
        }
                var cancel = document.createElement("input");
        cancel.setAttribute("type", "button");
        cancel.setAttribute("name", "cancel");
        cancel.value = "Cancel";
        cancel.Id = "cancel";
        cancel.setAttribute("onclick", "buy('cancel')");
        document.getElementById("buyableCards").appendChild(cancel);
        buyCount--;
        updateAll();
    }
}

function buy(card){
    if(card === 'cancel'){
        discardFromBuy(card);
        updateAll(); 
    }
    if ((moneyCount - card.cost) >= 0 && (card.remainingCards > 0)){
        moneyCount -= card.cost;
        card.remainingCards -= 1;
        discardFromBuy(card);
        updateAll(); 
    }
}

function discardFromBuy(card){
    if(card === 'cancel'){
        removeBuyableCards();
        buyCount++;
        updateAll();
    } else if(card) {
        discardPile.push(card);
        removeBuyableCards();
        updateAll();
    } else {
        document.getElementById("errorCatch").innerHTML="ERROR, NO CARD PASSED TO DISCARDFROMBUY";  
    }
}

function removeBuyableCards() {
    var removeCards = document.getElementById("buyableCards");
    while(removeCards.firstChild) {
        removeCards.removeChild(removeCards.firstChild);
    }
    removeCards.innerHTML="Buy: ";
}
// TODO: Ask for a selection of cards in the game, return selected cards as array
function listOfBuyableCards(){
    
}


function deckReader(){
        var deckReader = [];    
    for (var i in playerDeck){
            deckReader.push(playerDeck[i].name);
        }
        document.getElementById("deckTest").innerHTML="Deck: " + deckReader;
}

function discardReader(){
    var discardReader = [];
    for (var i in discardPile){
        discardReader.push(discardPile[i].name);
    }
    document.getElementById("discardPile").innerHTML="Discard Pile: " + discardReader;
}




function reDeck(discardPile){
    if(discardPile) {
        shuffle(discardPile);
        playerDeck = playerDeck.concat(discardPile.splice(0));
    }
    updateAll();
    return playerDeck;
}

function discardFromHand(card){
    if (hand.indexOf(card) > -1) {
        discardPile.push(hand[hand.indexOf(card)]);
        hand.splice(hand.indexOf(card), 1);
        var cardElement = document.getElementById(card.name);
        cardElement.parentNode.removeChild(cardElement);
    }
    updateAll();
}




        
function shuffle(deck) {
    var m = deck.length, t, i;
    while(m) {
        i = Math.floor(Math.random() * m--);
        t = deck[m];
        deck[m] = deck[i];
        deck[i] = t;
        }
    deckReader();
    discardReader();
    return deck;
}

</script>
<head>
</head>
<body>
<form>

<p id="deckTest">Deck:</p>
<p id="discardPile">Discard Pile:</p>
<p id="moneyCountId">Money: <span id="displayMoney"></span></p>
<p id="actionCountId">Actions: <span id="displayActions"></span></p>
<p id="buysCountId">Buys: <span id="displayBuys"></span></p>
    <input type="button" onclick="newTurn()" value="New turn">
    <input type="button" onclick="buyList()" value="Buy Cards">
    
<p></p>

<span id="playableHand">Hand: </span>

<p></p>

<span id="buyableCards">Buyable Cards:</span>

<p></p>

<p id="errorCatch"></p>
<p id="1"></p>
<p id="2"></p>
<p id="3"></p>
</form>
</body>
<script>
    document.getElementById("displayMoney").innerHTML=moneyCount;
    document.getElementById("displayActions").innerHTML=actionCount;
    document.getElementById("displayBuys").innerHTML=buyCount;
</script>
</html> 
