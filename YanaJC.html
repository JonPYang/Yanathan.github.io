<!DOCTYPE html>
<html>
<script>
var playerDeck = ["copper","copper","copper","copper","copper","silver","silver"], hand = [], discardPile = [];
var drawCount = 5;

/* TODO: 
Create buttons to add named cards into hand. 
Create money, draw, action values to cards and players
Work in multiple players*/


function buy(){
    var buyable = document.createElement("input");
    buyable.setAttribute("type", "button");
    buyable.setAttribute("value", "Province");
    buyable.setAttribute("onclick", "add(this.value)");
    document.getElementById("buyableCards").appendChild(buyable);
}
    
function add(cards){
    if(cards instanceof Array){
      for(var i = 0; i < drawCount && cards.length !== 0; i++) {
        hand.unshift(cards.shift()); 
          var deckCard = document.createElement("input");
          deckCard.setAttribute("type", "button");
          deckCard.setAttribute("Id", hand[0]);
          deckCard.setAttribute("value", hand[0]);
          deckCard.setAttribute("onclick", "discard(this.value)");
          document.getElementById("playableHand").appendChild(deckCard);
        }
    }
    else if(cards){
        hand.unshift(cards);
        deckCard.setAttribute("type", "button");
        deckCard.setAttribute("Id", hand[0]);
        deckCard.setAttribute("value", hand[0]);
        deckCard.setAttribute("onclick", "discard(this.value)");
        document.getElementById("playableHand").appendChild(deckCard);
    }
    
    else document.getElementById("errorCatch").innerHTML="ERROR: FAILURE TO ADD CARD";
    
    document.getElementById("deckTest").innerHTML="Deck: " + playerDeck;
    document.getElementById("discardPile").innerHTML="Discard Pile: " + discardPile;  
    return hand;
}

function check(){
    document.getElementById("deckTest").innerHTML="Deck: " + playerDeck;
    document.getElementById("discardPile").innerHTML="Discard Pile: " + discardPile;    
}
  
  
function newTurn() {
    while(hand.length > 0) {
        discard(hand[0]);
    }
    if (playerDeck.length > drawCount) {
        add(playerDeck);
    } else {
        reDeck(discardPile);
        add(playerDeck);
    }
}

function reDeck(discardPile){
    if(discardPile) {
        shuffle(discardPile);
        playerDeck = playerDeck.concat(discardPile.splice(0));
    }
        document.getElementById("deckTest").innerHTML="Deck: " + playerDeck;
    return playerDeck;
}

function discard(card){
    if (hand.indexOf(card) > -1) {
        discardPile.push(hand[hand.indexOf(card)]);
        hand.splice(hand.indexOf(card), 1);
        var cardElement = document.getElementById(card);
        cardElement.parentNode.removeChild(cardElement);
    }
    document.getElementById("deckTest").innerHTML="Deck: " + playerDeck;
    document.getElementById("discardPile").innerHTML="Discard Pile: " + discardPile; 
}

function shuffle(deck) {
  var m = deck.length, t, i;
  
  while(m) {
    i = Math.floor(Math.random() * m--);
    t = deck[m];
    deck[m] = deck[i];
    deck[i] = t;
  }
    document.getElementById("deckTest").innerHTML="Deck: " + playerDeck;
  return deck;
}

</script>
<head>
</head>
<body>
<form>

<p id="deckTest">Deck:</p>
<p id="discardPile">Discard Pile:</p>
<input type="button" onclick="newTurn()" value="New turn">
<input type="button" onclick="buy()" value="Province">
<p id="errorCatch"></p>
<span id="playableHand">Hand: </span>
<span id="buyableCards">Buy:</span>
</form>
</body>
</html> 
