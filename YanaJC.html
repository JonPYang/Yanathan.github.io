<!DOCTYPE html>

<html>
<script>

var drawCount = 5, buyCount = 1, actionCount = 1, moneyCount = 1;
var copper = {name:'copper', cardType:'money', money:1, cost:0}, silver = {name:'silver', cardType:'money', money:2, cost:3}, gold = {name:'gold', cardType:'money', money:3, cost:6};
var estate = {name:'estate', cardType:'victoryPoint', money:0, cost:2}
var chapel = {cardType:'action', cost:2};
var moat = {cardType:'actionReaction', card:2, cost:2};
var bureaucrat = {cardType:'actionAttack', cost:4};
var village = {cardType:'action', cost:3, card:1, actions:2};
var buyableCards = [copper, silver, gold]
var playerDeck = [copper,copper,copper,copper,copper,copper,copper,estate,estate,estate], hand = [], discardPile = [];


/* TODO: 
Ensure cards can only be brought with right amount of money
Enable cards keeping track of player values (draw/buy/action/money/victory points)

Change deck and discard pile to only show numbers of cards remaining instead of card values themselves

Enable cancel button when buying cards but check to see if anything else has been brought already
Create limit for buyable cards
Work in actionable cards
Create end game conditions

Work in multiple players
Work in online functionality*/

/*additional TODO:
Fix first turn to start as a first turn
Clean up GUI to show buyable cards on the side with cost and money remaining
Show cards on mouseover
Create log box for each action that occurs

*/
function onCardPress(card){
    document.getElementById("1").innerHTML="Card = " + card.name
    document.getElementById("2").innerHTML="Card.cardType = " + card.cardType
    if(card.cardType === 'money') {
        moneyCount += card.money;
    }
    else if(card.cardType === 'actionReaction') {
        
    }
    else if(card.cardType === 'actionAttack') {
        
    }
    else if(card.cardType === 'action') {
        
    }
    else {
        document.getElementById("errorCatch").innerHTML="ERROR, CARD TYPE NOT FOUND";         
    }
    document.getElementById("displayMoney").innerHTML=moneyCount;
    document.getElementById("displayActions").innerHTML=actionCount;
    document.getElementById("displayBuys").innerHTML=buyCount;
    discardFromHand(card);
}


function buy(){
    //var buyableCardArray = listOfBuyableCards()
    if(buyCount >= 1){
        for (var i in buyableCards) {
            var currentCard = buyableCards[i];
            var buyable = document.createElement("input");
            buyable.card = currentCard;
            buyable.setAttribute("type", "button");
            buyable.setAttribute("name", "PurchasableCards");
            buyable.value = currentCard.name;
            buyable.Id = currentCard.name;
            buyable.setAttribute("onclick", "discardFromBuy(this.card)");
            document.getElementById("buyableCards").appendChild(buyable);
        }
        buyCount--;
        document.getElementById("displayBuys").innerHTML=buyCount;
    }
}
    
// TODO: Ask for a selection of cards in the game, return selected cards as array
function listOfBuyableCards(){
    
}


function add(cards){
    if(cards instanceof Array){
      for(var i = 0; i < drawCount && cards.length !== 0; i++) {
            hand.unshift(cards.shift()); 
            var deckCard = document.createElement("input");
            var currentCard = hand[0];
            deckCard.card = currentCard
            deckCard.setAttribute("type", "button");
            deckCard.setAttribute("Id", currentCard.name);
            deckCard.setAttribute("value", currentCard.name);
            deckCard.setAttribute("onclick", "onCardPress(this.card)");
            document.getElementById("playableHand").appendChild(deckCard);
        }
    }
    else if(cards){
        hand.unshift(cards);
        var deckCard = document.createElement("input");
        deckCard.setAttribute("type", "button");
        deckCard.setAttribute("Id", cards.name);
        deckCard.setAttribute("value", cards.name);
        document.getElementById(cards.name).onClick(cards);
        document.getElementById("playableHand").appendChild(deckCard);
    }
    
    else 
        document.getElementById("errorCatch").innerHTML="ERROR: FAILURE TO ADD CARD";
    
    deckReader();
    discardReader();
    return hand;
}

function deckReader(){
        var deckReader = [];    
    for (var i in playerDeck){
            deckReader.push(playerDeck[i].name);
        }
        document.getElementById("deckTest").innerHTML="Deck: " + deckReader;
}

function discardReader(){
    var discardReader = [];
    for (var i in discardPile){
        discardReader.push(discardPile[i].name);
    }
    document.getElementById("discardPile").innerHTML="Discard Pile: " + discardReader;
}

function newTurn() {
    while(hand.length > 0) {
        discardFromHand(hand[0]);
    }
    if (playerDeck.length > drawCount) {
        add(playerDeck);
    } 
    else {
        reDeck(discardPile);
        add(playerDeck);
    }
    removeBuyableCards();
    buyCount = 1;
    document.getElementById("displayMoney").innerHTML=moneyCount;
    document.getElementById("displayActions").innerHTML=actionCount;
    document.getElementById("displayBuys").innerHTML=buyCount;
}



function reDeck(discardPile){
    if(discardPile) {
        shuffle(discardPile);
        playerDeck = playerDeck.concat(discardPile.splice(0));
    }
    deckReader();
    discardReader();
    return playerDeck;
}

function discardFromHand(card){
    if (hand.indexOf(card) > -1) {
        discardPile.push(hand[hand.indexOf(card)]);
        hand.splice(hand.indexOf(card), 1);
        var cardElement = document.getElementById(card.name);
        cardElement.parentNode.removeChild(cardElement);
    }
    deckReader();
    discardReader();
}

function discardFromBuy(card){
    discardPile.push(card);
    function removeBuyableCards() {
        var removeCards = document.getElementById("buyableCards");
            while(removeCards.firstChild) {
                removeCards.removeChild(removeCards.firstChild);
            }
            removeCards.innerHTML="Buy: ";
        }
    deckReader();
    discardReader(); 
}

function shuffle(deck) {
    var m = deck.length, t, i;
    while(m) {
        i = Math.floor(Math.random() * m--);
        t = deck[m];
        deck[m] = deck[i];
        deck[i] = t;
        }
    deckReader();
    discardReader();
    return deck;
}

</script>
<head>
</head>
<body>
<form>

<p id="deckTest">Deck:</p>
<p id="discardPile">Discard Pile:</p>
<p id="moneyCountId">Money: <span id="displayMoney"></span></p>
<p id="actionCountId">Actions: <span id="displayActions"></span></p>
<p id="buysCountId">Buys: <span id="displayBuys"></span></p>
    <input type="button" onclick="newTurn()" value="New turn">
    <input type="button" onclick="buy()" value="Buy Cards">
    
<p></p>

<span id="playableHand">Hand: </span>

<p></p>

<span id="buyableCards">Buyable Cards:</span>

<p></p>

<p id="errorCatch"></p>
<p id="1"></p>
<p id="2"></p>
<p id="3"></p>
</form>
</body>
<script>
    document.getElementById("displayMoney").innerHTML=moneyCount;
    document.getElementById("displayActions").innerHTML=actionCount;
    document.getElementById("displayBuys").innerHTML=buyCount;
</script>
</html> 
