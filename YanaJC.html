<!DOCTYPE html>
<html>
<script>
var playerDeck = ["copper","copper","copper","copper","copper","silver","silver"], hand = [], discardPile = [];
var drawCount = 5;
var copper = {name:'copper', cardType:'money', money:1, cost:0}, silver = {name:'silver', cardType:'money', money:2, cost:3}, gold = {name:'gold', cardType:'money', money:3, cost:6};
var chapel = {cardType:'action', cost:2};
var moat = {cardType:'actionReaction', card:2, cost:2};
var bureaucrat = {cardType:'actionAttack', cost:4};
var village = {cardType:'action', cost:3, card:1, actions:2};
var buyableCards = [copper, silver, gold]



/* TODO: 
Create buttons to add named cards into hand. 
Create money, draw, action values to cards and players
Work in multiple players*/


function buy(){
    //var buyableCardArray = listOfBuyableCards()

    for (var i in buyableCards) {
    var buyable = document.createElement("input");
    buyable.setAttribute("type", "button");
    buyable.setAttribute("name", "PurchasableCards");
    buyable.setAttribute("value", buyableCards[i].name);
    buyable.setAttribute("onclick", "add(this.value)");
    document.getElementById("buyableCards").appendChild(buyable);
    }
}
    
// TODO: Ask for a selection of cards in the game, return selected cards as array
function listOfBuyableCards(){
    
}

function add(cards){
    if(cards instanceof Array){
      for(var i = 0; i < drawCount && cards.length !== 0; i++) {
        hand.unshift(cards.shift()); 
          var deckCard = document.createElement("input");
          deckCard.setAttribute("type", "button");
          deckCard.setAttribute("Id", hand[0]);
          deckCard.setAttribute("value", hand[0]);
          deckCard.setAttribute("onclick", "discardFromHand(this.value)");
          document.getElementById("playableHand").appendChild(deckCard);
        }
    }
    else if(cards){
        hand.unshift(cards);
        var deckCard = document.createElement("input");
        deckCard.setAttribute("type", "button");
        deckCard.setAttribute("Id", cards);
        deckCard.setAttribute("value", cards);
        deckCard.setAttribute("onclick", "discardFromHand(this.value)");
        document.getElementById("playableHand").appendChild(deckCard);
    }
    
    else document.getElementById("errorCatch").innerHTML="ERROR: FAILURE TO ADD CARD";
    
    document.getElementById("deckTest").innerHTML="Deck: " + playerDeck;
    document.getElementById("discardPile").innerHTML="Discard Pile: " + discardPile;  
    return hand;
}

function check(){
    document.getElementById("deckTest").innerHTML="Deck: " + playerDeck;
    document.getElementById("discardPile").innerHTML="Discard Pile: " + discardPile;    
}
  
  
function newTurn() {
    while(hand.length > 0) {
        discardFromHand(hand[0]);
    }
    if (playerDeck.length > drawCount) {
        add(playerDeck);
    } else {
        reDeck(discardPile);
        add(playerDeck);
    }
  
  var removeBuyablesList = document.getElementsByName("PurchasableCards");
  var removeBuyables = document.getElementById("buyableCards");
  for (var i in removeBuyablesList)
        removeBuyables.parentNode.removeChild(removeBuyablesList[i]);
}

function reDeck(discardPile){
    if(discardPile) {
        shuffle(discardPile);
        playerDeck = playerDeck.concat(discardPile.splice(0));
    }
        document.getElementById("deckTest").innerHTML="Deck: " + playerDeck;
    return playerDeck;
}

function discardFromHand(card){
    if (hand.indexOf(card) > -1) {
        discardPile.push(hand[hand.indexOf(card)]);
        hand.splice(hand.indexOf(card), 1);
        var cardElement = document.getElementById(card);
        cardElement.parentNode.removeChild(cardElement);
    }
    document.getElementById("deckTest").innerHTML="Deck: " + playerDeck;
    document.getElementById("discardPile").innerHTML="Discard Pile: " + discardPile; 
}

function shuffle(deck) {
  var m = deck.length, t, i;
  
  while(m) {
    i = Math.floor(Math.random() * m--);
    t = deck[m];
    deck[m] = deck[i];
    deck[i] = t;
  }
    document.getElementById("deckTest").innerHTML="Deck: " + playerDeck;
  return deck;
}

</script>
<head>
</head>
<body>
<form>

<p id="deckTest">Deck:</p>
<p id="discardPile">Discard Pile:</p>
<input type="button" onclick="newTurn()" value="New turn">
<input type="button" onclick="buy()" value="Buy Cards">
<p id="errorCatch"></p>
<span id="playableHand">Hand: </span>
<span id="buyableCards">Buy:</span>
</form>
</body>
</html> 
