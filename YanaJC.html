<!DOCTYPE html>
<html>
<script>
var playerDeck = [1,2,3,4,5,6,7,8,9,10,11];
var hand = [];
var drawCount = 5;
var discardPile = [];
var cardsToAdd;
/* TODO: On new turn, discard all cards in hand, draw if there are enough cards to draw,
check if there are cards in discard pile to move to deck and draw, end drawing if both conditions fail.*/

function add(deck){
    if(deck.length !==0){
      for(var i = 0; i < drawCount && deck.length !== 0; i++) {
        hand.unshift(deck.shift()); 
          var element = document.createElement("input");
          element.setAttribute("type", "button");
          element.setAttribute("Id", hand[0]);
          element.setAttribute("value", hand[0]);
          element.setAttribute("onclick", "discard(Number(this.value))");
          document.getElementById("playableHand").appendChild(element);
        }
    }
    document.getElementById("deckTest").innerHTML="Deck: " + playerDeck;
    document.getElementById("discardPile").innerHTML="Discard Pile: " + discardPile;  
    return hand;
}

function check(){
    document.getElementById("deckTest").innerHTML="Deck: " + playerDeck;
    document.getElementById("discardPile").innerHTML="Discard Pile: " + discardPile;    
}
  
  
function newTurn() {
    while(hand.length > 0) {
        discard(hand[0]);
    }
    if (playerDeck.length > drawCount) {
        add(playerDeck);
    } else {
        reDeck(discardPile);
        add(playerDeck);
    }
}

function reDeck(discardPile){
    if(discardPile) {
        shuffle(discardPile);
        cardsToAdd = discardPile.splice(0);
        playerDeck = playerDeck.concat(cardsToAdd);
    }
        document.getElementById("concat").innerHTML="Concat: " + cardsToAdd
        document.getElementById("deckTest").innerHTML="Deck: " + playerDeck;
    return playerDeck;
}

function discard(card){
    if (hand.indexOf(card) > -1) {
        discardPile.shift(hand[hand.indexOf(card)]);
        hand.splice(hand.indexOf(card));
        var cardElement = document.getElementById(card);
        cardElement.parentNode.removeChild(cardElement);
    }
    document.getElementById("deckTest").innerHTML="Deck: " + playerDeck;
    document.getElementById("discardPile").innerHTML="Discard Pile: " + discardPile; 
}

function shuffle(deck) {
  var m = deck.length, t, i;
  
  while(m) {
    i = Math.floor(Math.random() * m--);
    t = deck[m];
    deck[m] = deck[i];
    deck[i] = t;
  }
    document.getElementById("deckTest").innerHTML="Deck: " + playerDeck;
  return deck;
}

</script>
<head>
</head>
<body>
<form>

<p id="deckTest">Deck:</p>
<p id="discardPile">Discard Pile:</p>
<p id="concat">Added cards: </p>
<input type="button" onclick="newTurn()" value="New turn">

<span id="playableHand">Deck: </span>
</form>
</body>
</html> 
